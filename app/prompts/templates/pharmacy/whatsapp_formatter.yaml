# Pharmacy Domain - WhatsApp Response Formatter Templates
# Purpose: Templates for WhatsApp interactive messages (buttons, lists, text)
# All templates support {variable} substitution via PharmacyTemplateRenderer

prompts:
  # ============================================================================
  # DEBT RESPONSE - SHOW_DEBT flow (Flujo 1: Consultar deuda)
  # Per pharmacy_flujo_mejorado_v2.md lines 74-78
  # ============================================================================
  - key: "pharmacy.formatter.debt_response"
    name: "Debt Response with Actions"
    description: "Shows total debt with invoices and 3 action buttons"
    version: "2.0.0"
    response_type: "buttons"
    title: "Consulta de Deuda"
    body_template: |
      *{pharmacy_name}*

      Perfecto *{customer_name}*, este es el resumen de tu cuenta:

      â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      *Deuda Total: {total_debt}*
      â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

      {debt_details}

      ElegÃ­ cÃ³mo querÃ©s continuar ğŸ‘‡
    buttons:
      - id: "btn_ver_detalle"
        titulo: "Ver detalle factura"
      - id: "btn_pagar_completo"
        titulo_template: "Pagar {total_debt}"
      - id: "btn_pago_parcial"
        titulo: "Pago parcial"
    awaiting_input: "debt_action"
    metadata:
      variables:
        required:
          - pharmacy_name
          - customer_name
          - total_debt
        optional:
          - debt_details

  # ============================================================================
  # PAY_DEBT_MENU - Flujo 2: Pagar deuda (directo desde menÃº)
  # Per pharmacy_flujo_mejorado_v2.md lines 109-112
  # ============================================================================
  - key: "pharmacy.formatter.pay_debt_menu"
    name: "Pay Debt Menu"
    description: "Shows debt summary with 2 payment buttons"
    version: "1.0.0"
    response_type: "buttons"
    title: "Pagar Deuda"
    body_template: |
      *{pharmacy_name}*

      Perfecto *{customer_name}*, este es el monto disponible para pagar:

      â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      *Total a Pagar: {total_debt}*
      â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

      Â¿CÃ³mo deseas pagar?
    buttons:
      - id: "btn_pagar_completo"
        titulo_template: "Pagar {total_debt}"
      - id: "btn_pago_parcial"
        titulo: "Pago parcial"
    awaiting_input: "pay_debt_action"
    metadata:
      variables:
        required:
          - pharmacy_name
          - customer_name
          - total_debt
        optional: []

  # ============================================================================
  # INVOICE_DETAIL - Ver detalle de factura
  # Per pharmacy_flujo_mejorado_v2.md lines 79-88
  # ============================================================================
  - key: "pharmacy.formatter.invoice_detail"
    name: "Invoice Detail"
    description: "Shows single invoice detail (no medications - privacy)"
    version: "1.0.0"
    response_type: "buttons"
    title: "Detalle de Factura"
    body_template: |
      *{pharmacy_name}*

      *Detalle de Comprobante*

      â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      *NÃºmero:* {invoice_number}
      *Fecha:* {invoice_date}
      *Monto:* {invoice_amount}
      â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

      Â¿QuÃ© deseas hacer?
    buttons:
      - id: "btn_volver_deuda"
        titulo: "Volver a deuda"
      - id: "btn_pagar_deuda"
        titulo: "Pagar deuda"
      - id: "btn_volver_menu"
        titulo: "MenÃº principal"
    awaiting_input: "invoice_detail_action"
    metadata:
      variables:
        required:
          - pharmacy_name
          - invoice_number
          - invoice_date
          - invoice_amount
        optional: []

  # ============================================================================
  # PAYMENT CONFIRMATION - Confirm payment (full or partial)
  # ============================================================================
  - key: "pharmacy.formatter.payment_confirmation_full"
    name: "Full Payment Confirmation"
    description: "Confirmation dialog for full payment"
    version: "1.0.0"
    response_type: "buttons"
    title: "ConfirmaciÃ³n de Pago"
    body_template: |
      *Confirmar Pago*

      Monto: {payment_amount}

      Â¿ConfirmÃ¡s el pago?
    buttons:
      - id: "btn_confirm_yes"
        titulo: "SÃ­, pagar"
      - id: "btn_confirm_no"
        titulo: "Cancelar"
    metadata:
      variables:
        required:
          - payment_amount
        optional: []

  - key: "pharmacy.formatter.payment_confirmation_partial"
    name: "Partial Payment Confirmation"
    description: "Confirmation dialog for partial payment"
    version: "1.0.0"
    response_type: "buttons"
    title: "ConfirmaciÃ³n de Pago"
    body_template: |
      *Confirmar Pago Parcial*

      Monto a pagar: {payment_amount}
      Saldo restante: {remaining_balance}

      Â¿ConfirmÃ¡s el pago?
    buttons:
      - id: "btn_confirm_yes"
        titulo: "SÃ­, pagar"
      - id: "btn_confirm_no"
        titulo: "Cancelar"
    metadata:
      variables:
        required:
          - payment_amount
          - remaining_balance
        optional: []

  # ============================================================================
  # PAYMENT AMOUNT REQUEST - Ask for partial payment amount with 50% suggestion
  # ============================================================================
  - key: "pharmacy.formatter.payment_amount_request"
    name: "Partial Payment Amount Request"
    description: "Ask how much to pay with 50% quick option"
    version: "1.0.0"
    response_type: "buttons"
    title: "Pago Parcial"
    body_template: |
      *Pago Parcial*

      Tu deuda total: {total_debt}

      Â¿CuÃ¡nto deseÃ¡s pagar hoy?

      PodÃ©s escribir el monto o elegir una opciÃ³n ğŸ‘‡
    buttons:
      - id: "btn_pagar_50"
        titulo_template: "Pagar {half_debt}"
      - id: "btn_pagar_completo"
        titulo_template: "Pagar {total_debt}"
    awaiting_input: "amount"
    metadata:
      variables:
        required:
          - total_debt
          - half_debt
        optional: []

  # ============================================================================
  # PAYMENT LINK - Display generated payment link
  # ============================================================================
  - key: "pharmacy.formatter.payment_link"
    name: "Payment Link Message"
    description: "Displays MercadoPago payment link"
    version: "1.0.0"
    response_type: "text"
    body_template: |
      *Link de Pago*

      Monto: {payment_amount}

      HacÃ© clic aquÃ­ para pagar:
      {mp_payment_link}

      El link tiene validez de 24 horas.
    metadata:
      variables:
        required:
          - payment_amount
          - mp_payment_link
        optional: []

  # ============================================================================
  # ACCOUNT SELECTION - List of registered accounts
  # ============================================================================
  - key: "pharmacy.formatter.account_selection"
    name: "Account Selection List"
    description: "Interactive list for selecting accounts"
    version: "1.0.0"
    response_type: "list"
    title: "Cuentas Disponibles"
    list_button_text: "Ver cuentas"
    body_template: |
      *SeleccionÃ¡ una cuenta*

      TocÃ¡ el botÃ³n para ver las opciones disponibles.
    list_item_add_person:
      id: "btn_add_new_person"
      titulo: "Agregar persona"
      descripcion: "Registrar nueva persona"
    metadata:
      variables:
        required: []
        optional:
          - registered_accounts

  # ============================================================================
  # OWN OR OTHER - Select own debt or another person's
  # ============================================================================
  - key: "pharmacy.formatter.own_or_other"
    name: "Own or Other Debt Selection"
    description: "Choose between own debt or another person's"
    version: "1.0.0"
    response_type: "buttons"
    title: "Consulta de Deuda"
    body_template: |
      Â¿DeseÃ¡s consultar tu propia deuda o la de otra persona?
    buttons:
      - id: "btn_own_debt"
        titulo: "Mi deuda"
      - id: "btn_other_debt"
        titulo: "Otra persona"
    metadata:
      variables:
        required: []
        optional: []

  # ============================================================================
  # MAIN MENU - Main menu options (with WhatsApp buttons)
  # ============================================================================
  - key: "pharmacy.formatter.main_menu"
    name: "Main Menu"
    description: "Main menu with WhatsApp interactive buttons"
    version: "2.0.0"
    response_type: "buttons"
    title: "MenÃº Principal"
    body_template: |
      Hola{customer_name_greeting} ğŸ˜Š
      Este es el canal de *{pharmacy_name}* para ver temas de cuenta corriente y pagos.

      ğŸ“Œ En este chat no se toman pedidos de farmacia.

      PodÃ©s escribirme en lenguaje natural o elegir una opciÃ³n ğŸ‘‡
    buttons:
      - id: "btn_consultar_deuda"
        titulo: "Consultar deuda"
      - id: "btn_pagar_deuda"
        titulo: "Pagar deuda"
      - id: "btn_otra_cuenta"
        titulo: "Ver otra cuenta"
    awaiting_input: "menu_selection"
    metadata:
      variables:
        required:
          - pharmacy_name
        optional:
          - customer_name_greeting

  # ============================================================================
  # AUTH SUCCESS MENU - Menu after successful account validation
  # ============================================================================
  - key: "pharmacy.formatter.auth_success_menu"
    name: "Auth Success Menu"
    description: "Menu shown after successful account validation with verification message"
    version: "1.0.0"
    response_type: "buttons"
    title: "Cuenta Verificada"
    body_template: |
      Â¡Listo{customer_name_greeting}! âœ…

      Tu cuenta quedÃ³ verificada correctamente.

      ElegÃ­ una opciÃ³n o escribÃ­ tu consulta ğŸ‘‡
    buttons:
      - id: "btn_consultar_deuda"
        titulo: "Consultar deuda"
      - id: "btn_pagar_deuda"
        titulo: "Pagar deuda"
      - id: "btn_otra_cuenta"
        titulo: "Ver otra cuenta"
    awaiting_input: "menu_selection"
    metadata:
      variables:
        required:
          - pharmacy_name
        optional:
          - customer_name_greeting

  # ============================================================================
  # NO DEBT - Customer has no debt
  # ============================================================================
  - key: "pharmacy.formatter.no_debt"
    name: "No Debt Message"
    description: "Displayed when customer has no pending debt"
    version: "1.0.0"
    response_type: "text"
    body_template: |
      ğŸ‰ *No registrÃ¡s deuda pendiente*

      La cuenta de {customer_name} estÃ¡ al dÃ­a.

      Si pensÃ¡s que esto no es correcto, podÃ©s comunicarte con la farmacia.
    metadata:
      variables:
        required: []
        optional:
          - customer_name

  # ============================================================================
  # ERROR MESSAGES - Error handling templates
  # ============================================================================
  - key: "pharmacy.formatter.error_plex_unavailable"
    name: "System Unavailable Error"
    description: "Plex system unavailable error message"
    version: "1.0.0"
    response_type: "text"
    body_template: |
      *Sistema No Disponible*

      El sistema de consultas no estÃ¡ disponible en este momento.
      Por favor intentÃ¡ mÃ¡s tarde o comunÃ­cate con la farmacia.
    metadata:
      variables:
        required: []
        optional: []

  - key: "pharmacy.formatter.error_payment_error"
    name: "Payment Error"
    description: "Payment processing error message"
    version: "1.0.0"
    response_type: "text"
    body_template: |
      *Error de Pago*

      Hubo un problema al procesar tu pago.
      Por favor intentÃ¡ nuevamente o comunÃ­cate con la farmacia.
    metadata:
      variables:
        required: []
        optional: []

  - key: "pharmacy.formatter.error_generic"
    name: "Generic Error"
    description: "Generic error fallback message"
    version: "1.0.0"
    response_type: "text"
    body_template: |
      *Error*

      OcurriÃ³ un error inesperado.
      Por favor intentÃ¡ nuevamente.
    metadata:
      variables:
        required: []
        optional: []

  # ============================================================================
  # FAREWELL - Goodbye message
  # ============================================================================
  - key: "pharmacy.formatter.farewell"
    name: "Farewell Message"
    description: "Goodbye message when conversation ends"
    version: "1.0.0"
    response_type: "text"
    is_complete: true
    body_template: |
      *{pharmacy_name}*

      Â¡Gracias por comunicarte{customer_name_greeting}!

      Que tengas un excelente dÃ­a.
    metadata:
      variables:
        required:
          - pharmacy_name
        optional:
          - customer_name_greeting

  # ============================================================================
  # REQUEST ACCOUNT NUMBER - Ask for pharmacy account number (PRIMARY AUTH)
  # ============================================================================
  - key: "pharmacy.formatter.request_account_number"
    name: "Request Account Number"
    description: "Request account number for identity verification (primary method)"
    version: "1.0.0"
    response_type: "text"
    awaiting_input: "account_number"
    body_template: |
      Para seguir, necesitamos confirmar tu cuenta.

      IngresÃ¡ tu *nÃºmero de cuenta* de la farmacia.

      ğŸ’¡ Lo encontrÃ¡s en tus comprobantes o recibos anteriores.
    metadata:
      variables:
        required: []
        optional: []

  # ============================================================================
  # ACCOUNT NOT FOUND - Account number not found with retry/DNI options
  # ============================================================================
  - key: "pharmacy.formatter.account_not_found"
    name: "Account Not Found"
    description: "Account number not found, show retry and DNI validation options"
    version: "1.0.0"
    response_type: "buttons"
    title: "Cuenta no encontrada"
    awaiting_input: "account_not_found"
    body_template: |
      No encontramos una cuenta con ese nÃºmero ğŸ˜•  
      Puede ser un error al escribirlo.

      PodÃ©s volver a intentar o confirmar tu cuenta con DNI y nombre.    buttons:
      - id: "btn_retry_account"
        titulo: "Volver a intentar"
      - id: "btn_validate_dni"
        titulo: "Validar por DNI"
    metadata:
      variables:
        required: []
        optional:
          - pending_account_number

  # ============================================================================
  # VALIDATION FAILED - DNI/name validation failed, contact pharmacy
  # ============================================================================
  - key: "pharmacy.formatter.validation_failed"
    name: "Validation Failed"
    description: "DNI/name validation failed, contact pharmacy"
    version: "1.0.0"
    response_type: "text"
    is_complete: true
    body_template: |
      No pudimos confirmar tu cuenta con los datos ingresados ğŸ˜•.

      Para ayudarte mejor, comunicate con la farmacia o acercate personalmente.

      ğŸ“ {pharmacy_phone}
      ğŸ“ {pharmacy_address}
    metadata:
      variables:
        required: []
        optional:
          - pharmacy_phone
          - pharmacy_address

  # ============================================================================
  # REQUEST DNI - Ask for DNI number (FALLBACK AUTH)
  # ============================================================================
  - key: "pharmacy.formatter.request_dni"
    name: "Request DNI"
    description: "Request DNI for identity verification (fallback method)"
    version: "1.0.0"
    response_type: "text"
    awaiting_input: "dni"
    body_template: |
      Para continuar, confirmemos tu cuenta.

      IngresÃ¡ tu *DNI* (solo nÃºmeros).
    metadata:
      variables:
        required: []
        optional: []

  # ============================================================================
  # REQUEST NAME - Ask for customer name
  # ============================================================================
  - key: "pharmacy.formatter.request_name"
    name: "Request Name"
    description: "Request name for identity verification"
    version: "1.0.0"
    response_type: "text"
    awaiting_input: "name"
    body_template: |
      Ahora ingresÃ¡ tu *nombre completo*, tal como figura en la cuenta.
    metadata:
      variables:
        required: []
        optional: []
