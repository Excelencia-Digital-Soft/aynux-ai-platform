# Pharmacy Critical Templates
# Estos templates NO pasan por LLM - se usan tal cual
# Son para mensajes que requieren exactitud legal, de seguridad o consistencia

prompts:
  # =========================================================================
  # CONFIRMACIONES DE PAGO (Legal/Exactitud)
  # =========================================================================

  - key: pharmacy.critical.payment_confirmation
    name: Payment Confirmation
    description: Confirmación antes de generar link de pago
    version: "1.0.0"
    template: |
      Vas a pagar **${amount}** de tu deuda total de **${total_debt}**.

      Responde *SI* para generar el link de pago o *NO* para cancelar.
    metadata:
      variables:
        required:
          - amount
          - total_debt

  - key: pharmacy.critical.payment_link_generated
    name: Payment Link Generated
    description: Link de pago generado exitosamente
    version: "1.0.0"
    template: |
      Aquí está tu link de pago por **${amount}**:

      {payment_link}

      El link es válido por 24 horas.
    metadata:
      variables:
        required:
          - amount
          - payment_link

  - key: pharmacy.critical.partial_payment_confirmation
    name: Partial Payment Confirmation
    description: Confirmación de pago parcial
    version: "1.0.0"
    template: |
      Vas a realizar un pago parcial de **${amount}**.
      Tu deuda total es de **${total_debt}**, quedará un saldo de **${remaining}**.

      Responde *SI* para generar el link de pago o *NO* para cancelar.
    metadata:
      variables:
        required:
          - amount
          - total_debt
          - remaining

  # =========================================================================
  # ERRORES DE SISTEMA
  # =========================================================================

  - key: pharmacy.critical.system_error
    name: System Error
    description: Error técnico genérico
    version: "1.0.0"
    template: |
      Disculpa, tuve un problema técnico.
      Por favor intenta de nuevo en unos momentos.
      Si persiste, contacta a {pharmacy_phone}.
    metadata:
      variables:
        required:
          - pharmacy_phone

  - key: pharmacy.critical.plex_unavailable
    name: PLEX Unavailable
    description: Sistema PLEX no disponible
    version: "1.0.0"
    template: |
      El sistema de la farmacia no está disponible en este momento.
      Por favor intenta en unos minutos o contacta a {pharmacy_phone}.
    metadata:
      variables:
        required:
          - pharmacy_phone

  - key: pharmacy.critical.payment_error
    name: Payment Error
    description: Error al generar link de pago
    version: "1.0.0"
    template: |
      No pude generar el link de pago en este momento.
      Por favor intenta de nuevo o contacta a {pharmacy_phone}.
    metadata:
      variables:
        required:
          - pharmacy_phone

  # =========================================================================
  # VALIDACIONES (Formato estricto)
  # =========================================================================

  - key: pharmacy.critical.request_identifier
    name: Request Identifier
    description: Solicitar DNI y nombre para identificación
    version: "1.0.0"
    template: |
      Para identificarte, necesito tu *DNI* y *nombre completo* en un solo mensaje.

      Ejemplo: *12345678 Juan Pérez*

      Por favor, escribilos a continuación:
    metadata:
      variables:
        required: []

  - key: pharmacy.critical.request_dni_welcome
    name: Request DNI Welcome
    description: Solicitar DNI en flujo de bienvenida
    version: "1.0.0"
    template: |
      Para verificar tu identidad, por favor ingresa tu número de DNI:
    metadata:
      variables:
        required: []

  - key: pharmacy.critical.request_dni_for_other
    name: Request DNI For Other
    description: Solicitar DNI de otra persona
    version: "1.0.0"
    template: |
      Para consultar la deuda de otra persona, necesito su número de DNI.

      Por favor, ingresa el DNI de la persona que deseas consultar:
    metadata:
      variables:
        required: []

  - key: pharmacy.critical.dni_not_found
    name: DNI Not Found
    description: DNI no encontrado en el sistema
    version: "1.0.0"
    template: |
      No encontré ese DNI en nuestro sistema.
      Verifica el número e intenta de nuevo, o contacta a {pharmacy_phone}.
    metadata:
      variables:
        required:
          - pharmacy_phone

  - key: pharmacy.critical.identifier_not_found
    name: Identifier Not Found
    description: DNI/Nombre no encontrado en el sistema
    version: "1.0.0"
    template: |
      No encontré esos datos en nuestro sistema.
      Verifica el DNI y nombre e intenta de nuevo, o contacta a {pharmacy_phone}.
    metadata:
      variables:
        required:
          - pharmacy_phone

  - key: pharmacy.critical.invalid_identifier_format
    name: Invalid Identifier Format
    description: Formato de identificación inválido
    version: "1.0.0"
    template: |
      No pude identificar tu DNI y nombre.

      Por favor, escríbelos en un solo mensaje con este formato:
      *DNI Nombre Apellido*

      Ejemplo: *12345678 Juan Pérez*
    metadata:
      variables:
        required: []

  - key: pharmacy.critical.request_name_verification
    name: Request Name Verification
    description: Solicitar nombre para verificar identidad después de encontrar DNI
    version: "1.0.0"
    template: |
      Encontré tu DNI en el sistema, pero necesito también tu *nombre completo* para verificar tu identidad.

      Por favor, escribí tu nombre y apellido:
    metadata:
      variables:
        required: []

  - key: pharmacy.critical.invalid_dni_format
    name: Invalid DNI Format
    description: DNI con formato inválido
    version: "1.0.0"
    template: |
      El DNI ingresado no es válido.
      Por favor ingresa solo números (ej: 12345678):
    metadata:
      variables:
        required: []

  - key: pharmacy.critical.max_validation_attempts
    name: Max Validation Attempts
    description: Se superaron los intentos de validación
    version: "1.0.0"
    template: |
      Has superado el número máximo de intentos de validación.
      Por motivos de seguridad, contacta directamente a {pharmacy_phone}.
    metadata:
      variables:
        required:
          - pharmacy_phone

  - key: pharmacy.critical.max_errors_reached
    name: Max Errors Reached
    description: Se alcanzó el límite de errores
    version: "1.0.0"
    template: |
      Lo siento, hubo demasiados errores en el proceso.
      Por favor, intenta de nuevo más tarde o contacta a {pharmacy_phone}.
    metadata:
      variables:
        required:
          - pharmacy_phone

  - key: pharmacy.critical.name_mismatch
    name: Name Mismatch
    description: El nombre no coincide con el del sistema
    version: "1.0.0"
    template: |
      El nombre ingresado no coincide con nuestros registros.
      Por favor, verifica e intenta de nuevo con tu nombre completo tal como aparece en tu documento.
    metadata:
      variables:
        required: []

  - key: pharmacy.critical.generic_error
    name: Generic Error
    description: Error genérico del sistema
    version: "1.0.0"
    template: |
      Ocurrió un error inesperado.
      Por favor, intenta de nuevo o contacta a {pharmacy_phone}.
    metadata:
      variables:
        required:
          - pharmacy_phone

  - key: pharmacy.critical.welcome_new_user
    name: Welcome New User
    description: Bienvenida a usuarios nuevos
    version: "1.0.0"
    template: |
      ¡Bienvenido a {pharmacy_name}!

      Soy el asistente virtual y puedo ayudarte con:
      • Consultar tu deuda
      • Generar links de pago
      • Información de la farmacia

      ¿En qué puedo ayudarte hoy?
    metadata:
      variables:
        required:
          - pharmacy_name

  - key: pharmacy.critical.explain_identity_verification
    name: Explain Identity Verification
    description: Explicar por qué se necesita verificación de identidad
    version: "1.0.0"
    template: |
      La verificación de identidad protege tus datos personales y de deuda.

      Solo necesito tu DNI y nombre para confirmar que sos vos.
      Estos datos NO se comparten ni se almacenan de forma permanente.

      ¿Querés continuar con la verificación?
    metadata:
      variables:
        required: []

  - key: pharmacy.critical.ambiguous_welcome_response
    name: Ambiguous Welcome Response
    description: Respuesta ambigua en el flujo de bienvenida
    version: "1.0.0"
    template: |
      No entendí tu respuesta.

      Por favor, elegí una opción:
      1) Verificar mi identidad (cliente existente)
      2) Registrarme (nuevo cliente)
      3) Solo quiero información
    metadata:
      variables:
        required: []

  - key: pharmacy.critical.invalid_amount
    name: Invalid Amount
    description: Monto de pago inválido
    version: "1.0.0"
    template: |
      El monto ingresado no es válido.
      Por favor ingresa un número mayor a 0 y menor o igual a tu deuda de **${total_debt}**.
    metadata:
      variables:
        required:
          - total_debt

  # =========================================================================
  # DATOS SENSIBLES
  # =========================================================================

  - key: pharmacy.critical.identity_verified
    name: Identity Verified
    description: Identidad verificada exitosamente
    version: "1.0.0"
    template: |
      Identidad verificada: **{name}** (DNI: ***{dni_last4}).
      Este registro será válido por 180 días.
    metadata:
      variables:
        required:
          - name
          - dni_last4

  - key: pharmacy.critical.registration_renewed
    name: Registration Renewed
    description: Registro renovado exitosamente
    version: "1.0.0"
    template: |
      Ya tienes a **{name}** registrado.
      Renové el registro por 180 días más.
    metadata:
      variables:
        required:
          - name

  - key: pharmacy.critical.debt_display
    name: Debt Display
    description: Mostrar deuda del cliente (datos sensibles)
    version: "1.0.0"
    template: |
      **Deuda de {customer_name}**

      Total pendiente: **${total_debt}**
      Cantidad de comprobantes: {invoice_count}

      {debt_details}

      ¿Deseas generar un link de pago?
      Responde *SI* para el total o indica el monto para un pago parcial.
    metadata:
      variables:
        required:
          - customer_name
          - total_debt
          - invoice_count
          - debt_details
