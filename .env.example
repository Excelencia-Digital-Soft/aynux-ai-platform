# =============================================================================
# AYNUX - Environment Configuration Template
# =============================================================================
# Copy this file to .env and configure your values:
#   cp .env.example .env
#
# Variables marked with (required) MUST be set before running the application.
# Variables marked with (optional) have sensible defaults for development.
#
# For Docker deployment, see: docs/DOCKER_DEPLOYMENT.md
# =============================================================================


# =============================================================================
# 1. APPLICATION CORE
# Core application settings that control runtime behavior
# =============================================================================

# Environment mode: development | production | test
ENVIRONMENT=development

# Enable debug mode with verbose logging (disable in production)
DEBUG=true

# Enable test mode for running test suites
TESTING=false

# Skip database initialization on startup (useful for Docker)
SKIP_DB_INIT=false

# Multi-Tenancy Configuration
MULTI_TENANT_MODE=true
TENANT_HEADER=X-Tenant-ID


# =============================================================================
# 2. API CONFIGURATION
# FastAPI application metadata and routing
# =============================================================================

# API version prefix for all routes
API_V1_STR=/api/v1

# Application display name (shown in OpenAPI docs)
PROJECT_NAME=Aynux WhatsApp Bot

# Application description for API documentation
PROJECT_DESCRIPTION=Multi-domain WhatsApp bot with AI agents

# Application version
VERSION=1.0.0


# =============================================================================
# 3. CHATTIGO INTEGRATION (WhatsApp via ISV)
# Chattigo is a WhatsApp Business API intermediary that handles Meta verification
# ISV mode: Chattigo manages WhatsApp credentials, we only need endpoint config
# =============================================================================

# Enable Chattigo integration (required, default: true)
CHATTIGO_ENABLED=true

# Chattigo API base URL
CHATTIGO_BASE_URL=https://channels.chattigo.com/bsp-cloud-chattigo-isv

# NOTE: Chattigo credentials (username, password, bot_name, channel_id, campaign_id)
# are now stored in the database with encryption.
# Configure credentials via Admin API:
#   POST /api/v1/admin/chattigo-credentials
# See docs/CHATTIGO.md for setup instructions.


# =============================================================================
# 4. POSTGRESQL DATABASE
# Primary database connection settings
# =============================================================================

# Database hostname (use 'postgres' for Docker)
DB_HOST=localhost

# PostgreSQL port
DB_PORT=5432

# Database name
DB_NAME=aynux

# Database username
DB_USER=postgres

# Database password (leave empty for local dev without auth)
DB_PASSWORD=

# Log SQL queries for debugging (disable in production)
DB_ECHO=false


# =============================================================================
# 5. DATABASE POOL SETTINGS
# Connection pool configuration for production performance
# =============================================================================

# Number of persistent connections in the pool (1-100)
DB_POOL_SIZE=20

# Maximum overflow connections above pool size (0-200)
DB_MAX_OVERFLOW=30

# Recycle connections after this many seconds
DB_POOL_RECYCLE=3600

# Timeout waiting for a connection from pool (seconds)
DB_POOL_TIMEOUT=30


# =============================================================================
# 6. REDIS CACHE
# Redis server for caching, sessions, and rate limiting
# =============================================================================

# Redis hostname (use 'redis' for Docker)
REDIS_HOST=localhost

# Redis port
REDIS_PORT=6379

# Redis database number (0-15)
REDIS_DB=0

# Redis password (leave empty for local dev without auth)
REDIS_PASSWORD=


# =============================================================================
# 7. vLLM AI/LLM (High-Performance Inference)
# vLLM server provides OpenAI-compatible API for fast LLM inference
# =============================================================================

# vLLM API URL (OpenAI-compatible endpoint)
# Dev: http://localhost:8090/v1
# Prod: http://192.168.0.140:8090/v1
VLLM_BASE_URL=http://localhost:8090/v1

# vLLM API key (use 'EMPTY' for no authentication)
VLLM_API_KEY=EMPTY

# Single model for all complexity tiers
VLLM_MODEL=qwen-3b

# =============================================================================
# vLLM PERFORMANCE SETTINGS
# =============================================================================

# Timeout for vLLM requests in seconds
VLLM_REQUEST_TIMEOUT=120

# Maximum retries for vLLM requests
VLLM_MAX_RETRIES=3

# =============================================================================
# LLM STREAMING CONFIGURATION
# =============================================================================

# Enable streaming for web responses (WebSocket/SSE)
LLM_STREAMING_ENABLED=false

# Enable streaming for webhook responses (usually false for WhatsApp)
LLM_STREAMING_FOR_WEBHOOK=false


# =============================================================================
# 7b. TEI EMBEDDINGS (BAAI/bge-m3)
# Text Embeddings Inference - High-performance embedding service (1024 dimensions)
# =============================================================================

# TEI embedding server URL
# Dev: http://localhost:7997
# Prod: http://192.168.0.140:7997
TEI_BASE_URL=http://localhost:7997

# Embedding model (BAAI/bge-m3 is recommended for multilingual support)
TEI_MODEL=BAAI/bge-m3

# Embedding dimension (1024 for bge-m3)
TEI_EMBEDDING_DIMENSION=1024

# Timeout for TEI requests in seconds
TEI_REQUEST_TIMEOUT=30


# =============================================================================
# 8. VECTOR SEARCH (pgvector)
# PostgreSQL native vector similarity search configuration
# Note: pgvector is always enabled (no toggle)
# =============================================================================

# Minimum similarity threshold for search results (0.0-1.0, higher = stricter)
# Used for both product search and knowledge base
PGVECTOR_SIMILARITY_THRESHOLD=0.7


# =============================================================================
# 9. KNOWLEDGE BASE (RAG)
# Retrieval-Augmented Generation configuration
# =============================================================================

# Enable RAG knowledge base for domain-specific information
KNOWLEDGE_BASE_ENABLED=true

# Note: Knowledge base uses TEI_MODEL for embeddings (1024 dims)
# and PGVECTOR_SIMILARITY_THRESHOLD for similarity matching


# =============================================================================
# 10. DUX ERP INTEGRATION
# External ERP system connection for product data
# =============================================================================

# DUX API base URL
DUX_API_BASE_URL=https://erp.duxsoftware.com.ar/WSERP/rest/services

# (required for DUX) API authentication key
DUX_API_KEY=your_dux_api_key

# Request timeout in seconds
DUX_API_TIMEOUT=30

# Minimum seconds between API requests (rate limiting)
DUX_API_RATE_LIMIT_SECONDS=5

# Batch size for product synchronization
DUX_SYNC_BATCH_SIZE=50


# =============================================================================
# 11. DUX SYNCHRONIZATION
# Master toggle for DUX ERP integration (sync + ProductAgent)
# =============================================================================

# Master toggle for DUX integration
# When disabled (false):
#   - Background sync service does NOT start
#   - ProductAgent is automatically disabled from agent flow
# When enabled (true):
#   - Background sync runs at configured hours (DUX_SYNC_HOURS)
#   - ProductAgent is available for product queries
DUX_SYNC_ENABLED=false

# Hours to run automatic sync (24-hour format, JSON array)
# Example: [2, 14] means 2:00 AM and 2:00 PM
DUX_SYNC_HOURS=[2, 14]

# Force sync if data is older than this many hours
DUX_FORCE_SYNC_THRESHOLD_HOURS=24


# =============================================================================
# 11b. PLEX ERP INTEGRATION (Pharmacy)
# Plex ERP system for pharmacy debt and invoice management
# Auth: HTTP Basic Authentication
# =============================================================================

# Plex ERP API base URL (local network address)
PLEX_API_BASE_URL=http://192.168.100.10:8081/wsplex

# HTTP Basic Auth username for Plex API
PLEX_API_USER=your_plex_username

# HTTP Basic Auth password for Plex API
PLEX_API_PASS=your_plex_password

# Request timeout in seconds
PLEX_API_TIMEOUT=30


# =============================================================================
# 11c. PAYMENT RECEIPT STORAGE
# PDF receipt storage settings (MP and pharmacy config now in database)
# =============================================================================

# Directory path for storing PDF receipts
RECEIPT_STORAGE_PATH=app/static/receipts

# Number of days to keep receipts before cleanup
RECEIPT_CLEANUP_DAYS=30

# NOTE: Mercado Pago credentials and pharmacy info are now stored per-organization
# in the database (pharmacy_merchant_configs table). Configure via admin UI or
# direct database insert. See: PharmacyMerchantConfig model and PharmacyConfigService


# =============================================================================
# 12. AGENT CONFIGURATION
# LangGraph multi-agent system settings
# =============================================================================

# Agent configuration is now managed via database (core.agents table)
# Use the Admin API for agent management:
#   GET  /api/v1/admin/agents          - List all agents
#   POST /api/v1/admin/agents          - Create agent
#   POST /api/v1/admin/agents/seed/builtin - Seed builtin agents
#   PUT  /api/v1/admin/agents/{id}     - Update agent
#   POST /api/v1/admin/agents/{id}/toggle - Toggle enabled status
#
# Available builtin agents:
#   - greeting_agent: Handles greetings and system capabilities
#   - ecommerce_agent: Consolidated e-commerce agent with subgraph
#   - data_insights_agent: Analytics and reporting
#   - support_agent: Technical support
#   - excelencia_agent: Excelencia Software queries
#   - excelencia_invoice_agent: Client invoicing
#   - excelencia_promotions_agent: Software promotions
#   - excelencia_support_agent: Software support
#   - pharmacy_operations_agent: Pharmacy debt and invoice workflows
#   - fallback_agent: Default responses
#   - farewell_agent: Conversation closure
#
# After running migration, seed builtin agents:
#   alembic upgrade head
#   POST /api/v1/admin/agents/seed/builtin

# Data source for product agent (always 'database' with pgvector)
PRODUCT_AGENT_DATA_SOURCE=database


# =============================================================================
# 13. JWT AUTHENTICATION
# JSON Web Token configuration for API authentication
# =============================================================================

# (required) Secret key for JWT signing (min 32 characters, use a secure random value)
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
JWT_SECRET_KEY=generate_a_secure_random_key_at_least_32_characters

# Access token expiration in minutes (1440 = 24 hours)
ACCESS_TOKEN_EXPIRE_MINUTES=1440

# Refresh token expiration in days
REFRESH_TOKEN_EXPIRE_DAYS=7


# =============================================================================
# 14. FILE UPLOAD
# File upload limits and allowed types
# =============================================================================

# Maximum file size in bytes (10485760 = 10MB)
MAX_FILE_SIZE=10485760

# Allowed file extensions (JSON array format)
ALLOWED_EXTENSIONS=["jpg","jpeg","png","pdf","doc","docx"]


# =============================================================================
# 15. LANGSMITH MONITORING
# LangChain observability and tracing platform
# =============================================================================

# Enable LangSmith tracing
LANGSMITH_TRACING=false

# LangSmith API endpoint
LANGSMITH_ENDPOINT=https://api.smith.langchain.com

# (required if tracing enabled) LangSmith API key
LANGSMITH_API_KEY=lsv2_your_langsmith_api_key

# LangSmith project name for trace organization
LANGSMITH_PROJECT=aynux-development

# Enable verbose logging for LangSmith
LANGSMITH_VERBOSE=false

# Trace sampling rate (0.0-1.0, 1.0 = trace all requests)
LANGSMITH_SAMPLE_RATE=1.0

# Enable automatic evaluation of traces
LANGSMITH_AUTO_EVAL=false

# Enable metrics collection
LANGSMITH_METRICS_ENABLED=true

# Dataset name for evaluations
LANGSMITH_DATASET_NAME=aynux-evals


# =============================================================================
# 16. SENTRY ERROR TRACKING
# Error monitoring and performance tracking
# =============================================================================

# Sentry DSN (Data Source Name) for error reporting
# Leave empty to disable Sentry
SENTRY_DSN=


# =============================================================================
# 17. CREDENTIAL ENCRYPTION (pgcrypto)
# Encryption key for sensitive tenant credentials stored in database
# =============================================================================

# (required) 32-byte encryption key for encrypting credentials at rest
# Used by: Chattigo credentials, WhatsApp tokens, ERP API keys
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
# IMPORTANT: Once set, do NOT change - existing encrypted data will be unrecoverable
CREDENTIAL_ENCRYPTION_KEY=


# =============================================================================
# END OF CONFIGURATION
# =============================================================================
